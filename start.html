<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Mechanic 4</title>
<link rel="icon" href="/images/logo/m4-favicon.ico" sizes="any">
<link rel="icon" type="image/png" href="/images/logo/m4-icon.png">
<link rel="apple-touch-icon" href="/images/logo/m4-icon.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#00c300">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="mobile-web-app-capable" content="yes">

<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
html, body { height: 100%; overflow: hidden; }

html { 
    background-color: #00c300;
    padding: env(safe-area-inset-top, 0px) env(safe-area-inset-right, 0px) env(safe-area-inset-bottom, 0px) env(safe-area-inset-left, 0px);
}

body {
    background-color: #eae9ec;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    min-height: -webkit-fill-available;
}

header {
    background-color: #00c300;
    height: 70px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    padding: 0 20px;
    position: relative;
}

.header-center {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 8px;
}

.kpn-logo { height: 38px; }

.header-title {
    font-size: 1.3rem;
    font-weight: bold;
    color: #fff;
}

.middle-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: visible;
    z-index: 0;
}

.welcome {
    font-size: 2.6rem;
    font-weight: bold;
    color: #222;
    margin-bottom: 0;
}

.knop-wrapper {
    position: relative;
    display: inline-block;
    margin-top: 60px;
}

.start-button {
    display: block;
    padding: 20px 60px;
    font-size: 1.4rem;
    background-color: #00c300;
    color: #fff;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 6px 20px rgba(0,195,0,0.3);
    animation: pulse 2.5s ease-in-out infinite;
    position: relative;
    z-index: 2;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.start-button.geen-pulse {
    animation: none !important;
    transform: scale(1) !important;
    box-shadow: 0 6px 20px rgba(0,195,0,0.3) !important;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); box-shadow: 0 6px 20px rgba(0,195,0,0.3); }
    50% { transform: scale(1.05); box-shadow: 0 8px 25px rgba(0,195,0,0.5); }
}

.start-button:active {
    transform: scale(0.95) !important;
    animation: none;
}

.kat {
    position: fixed;
    font-size: 3.2rem;
    z-index: 10;
    pointer-events: none;
    display: none;
    filter: drop-shadow(0 3px 6px rgba(0,0,0,0.25));
    line-height: 1;
}

.kat-zit {
    position: absolute;
    font-size: 2.4rem;
    top: -38px;
    left: 50%;
    transform: translateX(-50%);
    display: none;
    z-index: 5;
    line-height: 1;
    filter: drop-shadow(0 3px 6px rgba(0,0,0,0.25));
}

.graffiti-container {
    position: absolute;
    pointer-events: none;
    z-index: 3;
    display: none;
    text-align: center;
}

.graffiti-container.actief {
    display: block;
}

.graffiti-container svg * {
    fill: none !important;
}

.spray-streak {
    position: absolute;
    width: 3px;
    height: 8px;
    border-radius: 2px;
    z-index: 26;
    pointer-events: none;
    opacity: 0;
}

@keyframes spray-streak {
    0% { 
        opacity: 0.8; 
        transform: translate(0, 0) scale(1); 
    }
    100% { 
        opacity: 0; 
        transform: translate(var(--tx), var(--ty)) scale(0.5); 
    }
}

.spons {
    position: absolute;
    font-size: 6rem;
    z-index: 25;
    pointer-events: none;
    display: none;
    filter: drop-shadow(0 3px 6px rgba(0,0,0,0.25));
    line-height: 1;
}

.wipe-overlay {
    position: absolute;
    background-color: #eae9ec;
    pointer-events: none;
    z-index: 24;
    display: none;
}

.gif-section {
    flex: 0 0 38vh;
    width: 100%;
    overflow: hidden;
    display: flex;
    align-items: flex-end;
    line-height: 0;
    flex-shrink: 0;
}

.gif-section img {
    width: 100%;
    display: block;
}

footer {
    background-color: #00c300;
    color: #fff;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    flex-shrink: 0;
    min-height: 55px;
    padding-bottom: env(safe-area-inset-bottom, 0px);
}
</style>
</head>

<body>

<header>
    <div class="header-center">
        <img src="images/logo/kpn-logo.png" class="kpn-logo">
        <span class="header-title">Mechanic 4</span>
    </div>
</header>

<div class="middle-section" id="middleSection">
    <div class="welcome">Hoi Colin,</div>

    <div class="knop-wrapper" id="knopWrapper">
        <span class="kat-zit" id="katZit">üò∏</span>
        <button class="start-button" id="startBtn" onclick="window.location.href='index.html'">Start</button>
    </div>

    <div class="graffiti-container" id="graffitiContainer"></div>
    <div class="wipe-overlay" id="wipeOverlay"></div>
    <div class="spons" id="spons">üßΩ</div>
</div>

<div class="kat" id="kat">üêà</div>

<div class="gif-section">
    <img src="images/mechanics/m4-all.gif" alt="Mechanic4">
</div>

<footer>&copy; KPN 2026</footer>

<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').catch(e => console.log('SW:', e));
}

console.log('üöÄ Start');

// ========== KAT ANIMATIE ==========
const KAT_SPRINGEND = 'üêà';
const KAT_ZITTEND = ['üò∫', 'üòº', 'üò∏', 'üòπ'];

const katEl = document.getElementById('kat');
const katZitEl = document.getElementById('katZit');
const startBtn = document.getElementById('startBtn');

let katBezig = false;
let volgendeKantVanLinks = Math.random() < 0.5;
let emojiWisselInterval = null;

function wachtEnSpringSoms() {
    const wachttijd = 2000 + Math.random() * 3000;
    setTimeout(startKatAnimatie, wachttijd);
}

function startKatAnimatie() {
    if (katBezig) return;
    katBezig = true;
    startBtn.classList.add('geen-pulse');

    setTimeout(() => {
        const knopRect = startBtn.getBoundingClientRect();
        const doelX = knopRect.left + knopRect.width / 2 - 24;
        const doelY = knopRect.top - 51;

        const vanLinks = volgendeKantVanLinks;
        volgendeKantVanLinks = !volgendeKantVanLinks;

        const startX = vanLinks ? -80 : window.innerWidth + 20;
        const boogHoogte = 130 + Math.random() * 80;
        const springDuur = 750 + Math.random() * 200;

        katEl.textContent = KAT_SPRINGEND;
        katEl.style.display = 'block';
        katEl.style.left = startX + 'px';
        katEl.style.top = doelY + 'px';
        katEl.style.transform = vanLinks ? 'scaleX(-1)' : 'scaleX(1)';

        animeerBoog(startX, doelY, doelX, doelY, boogHoogte, springDuur, vanLinks, () => katLandt(doelX, doelY));
    }, 220);
}

function animeerBoog(x0, y0, x1, y1, boogH, duur, vanLinks, klaar) {
    const start = performance.now();
    function stap(nu) {
        const t = Math.min((nu - start) / duur, 1);
        const eT = easeInOut(t);
        const x = x0 + (x1 - x0) * eT;
        const y = y0 + (y1 - y0) * eT - boogH * 4 * eT * (1 - eT);
        const rotatie = vanLinks ? -15 + 30 * eT : 15 - 30 * eT;
        const spiegelX = vanLinks ? -1 : 1;
        katEl.style.left = x + 'px';
        katEl.style.top = y + 'px';
        katEl.style.transform = `scaleX(${spiegelX}) rotate(${rotatie}deg)`;
        if (t < 1) requestAnimationFrame(stap);
        else klaar();
    }
    requestAnimationFrame(stap);
}

function katLandt(doelX, doelY) {
    const bounceStart = performance.now();
    function bounce(nu) {
        const t = Math.min((nu - bounceStart) / 220, 1);
        const bounceY = doelY + Math.sin(t * Math.PI) * 10;
        katEl.style.top = bounceY + 'px';
        katEl.style.transform = 'scaleX(1) rotate(0deg)';
        if (t < 1) {
            requestAnimationFrame(bounce);
        } else {
            katEl.style.top = doelY + 'px';
            setTimeout(() => {
                katEl.style.display = 'none';
                katZitEl.style.display = 'block';
                katZitEl.textContent = randomZitEmoji();
                emojiWisselInterval = setInterval(() => {
                    katZitEl.textContent = randomZitEmoji();
                }, 2000);
                const zitTijd = 4000 + Math.random() * 4000;
                setTimeout(() => springWeg(doelX, doelY), zitTijd);
            }, 1000);
        }
    }
    requestAnimationFrame(bounce);
}

function springWeg(doelX, doelY) {
    clearInterval(emojiWisselInterval);
    emojiWisselInterval = null;
    katZitEl.style.display = 'none';
    katEl.textContent = KAT_SPRINGEND;
    katEl.style.display = 'block';
    katEl.style.left = doelX + 'px';
    katEl.style.top = doelY + 'px';
    const naarRechts = doelX < window.innerWidth / 2;
    const eindX = naarRechts ? window.innerWidth + 80 : -100;
    const boogHoogte = 110 + Math.random() * 80;
    const springDuur = 650 + Math.random() * 200;
    katEl.style.transform = naarRechts ? 'scaleX(-1)' : 'scaleX(1)';
    animeerBoog(doelX, doelY, eindX, doelY - 20, boogHoogte, springDuur, naarRechts, () => {
        katEl.style.display = 'none';
        startBtn.classList.remove('geen-pulse');
        katBezig = false;
        wachtEnSpringSoms();
    });
}

function randomZitEmoji() {
    return KAT_ZITTEND[Math.floor(Math.random() * KAT_ZITTEND.length)];
}

function easeInOut(t) {
    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
}

// ========== GRAFFITI SVG ANIMATIE ==========
const GRAFFITI_KLEUREN = ['#FF6B35', '#F7931E', '#00D9FF', '#FF00FF', '#7FFF00', '#FFD700'];

const graffitiContainer = document.getElementById('graffitiContainer');
const spons = document.getElementById('spons');
const wipeOverlay = document.getElementById('wipeOverlay');

let graffitiBezig = false;
let graffitiY = 0;
let graffitiHoogte = 0;
let sprayParticles = [];

function startGraffitiLoop() {
    setTimeout(startGraffitiAnimatie, 1000);
}

async function startGraffitiAnimatie() {
    console.log('üé® START GRAFFITI');
    
    if (graffitiBezig) return;
    graffitiBezig = true;

    const svgUrl = '/fonts/winnen-winnen-winnen.svg';
    const kleur = GRAFFITI_KLEUREN[Math.floor(Math.random() * GRAFFITI_KLEUREN.length)];

    try {
        const response = await fetch(svgUrl);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        
        let svgText = await response.text();
        
        // Verwijder fills EN strokes
        svgText = svgText.replace(/fill="[^"]*"/gi, '');
        svgText = svgText.replace(/fill:[^;"]*;?/gi, '');
        svgText = svgText.replace(/stroke="[^"]*"/gi, '');
        svgText = svgText.replace(/stroke:[^;"]*;?/gi, '');
        svgText = svgText.replace(/stroke-width="[^"]*"/gi, '');
        
        graffitiContainer.innerHTML = svgText;
        await new Promise(r => requestAnimationFrame(r));
        
        const svg = graffitiContainer.querySelector('svg');
        if (!svg) throw new Error('Geen SVG');
        
        console.log('‚úÖ SVG geladen');
        
        // Converteer MM naar PX
        const MM_TO_PX = 3.779527559;
        
        let widthMM, heightMM;
        const widthAttr = svg.getAttribute('width');
        const heightAttr = svg.getAttribute('height');
        
        if (widthAttr && widthAttr.includes('mm')) {
            widthMM = parseFloat(widthAttr);
            heightMM = parseFloat(heightAttr);
        } else {
            const viewBox = svg.getAttribute('viewBox');
            if (viewBox) {
                const parts = viewBox.split(/\s+|,/);
                widthMM = parseFloat(parts[2]);
                heightMM = parseFloat(parts[3]);
            } else {
                widthMM = 100;
                heightMM = 20;
            }
        }
        
        const widthPX = widthMM * MM_TO_PX;
        const heightPX = heightMM * MM_TO_PX;
        
        svg.setAttribute('viewBox', `0 0 ${widthPX} ${heightPX}`);
        svg.setAttribute('width', widthPX);
        svg.setAttribute('height', heightPX);
        
        await new Promise(r => requestAnimationFrame(r));
        
        // Vind paths
        const alleElementen = svg.querySelectorAll('*');
        const paths = [];
        
        alleElementen.forEach(elem => {
            const tagName = elem.tagName.toLowerCase();
            
            if (!['path', 'line', 'polyline', 'polygon', 'g', 'svg'].includes(tagName)) {
                elem.remove();
                return;
            }
            
            // ULTRA verwijder fill + stroke
            elem.removeAttribute('fill');
            elem.removeAttribute('stroke');
            elem.removeAttribute('stroke-width');
            elem.removeAttribute('style');
            elem.style.cssText = 'fill: none !important;';
            
            if (['path', 'line', 'polyline', 'polygon'].includes(tagName)) {
                try {
                    const length = elem.getTotalLength();
                    if (length > 0) {
                        paths.push({ path: elem, length });
                    }
                } catch (e) {}
            }
        });
        
        console.log('üõ§Ô∏è Paths gevonden:', paths.length);
        
        if (paths.length === 0) throw new Error('Geen paths');
        
        // SCHAAL: Max 80% van scherm breedte
        const maxWidth = window.innerWidth * 0.80;
        let schaal = maxWidth / widthPX;
        
        const nieuweWidth = widthPX * schaal;
        const nieuweHeight = heightPX * schaal;
        
        svg.style.width = nieuweWidth + 'px';
        svg.style.height = nieuweHeight + 'px';
        svg.style.display = 'block';
        
        console.log('üìè Grootte:', Math.round(nieuweWidth), 'x', Math.round(nieuweHeight));
        console.log('üìè Scherm breedte:', window.innerWidth);
        
        // Positioneer HORIZONTAAL GECENTREERD
        const knopRect = startBtn.getBoundingClientRect();
        const gifRect = document.querySelector('.gif-section').getBoundingClientRect();
        const beschikbareRuimte = gifRect.top - knopRect.bottom;
        const centerY = knopRect.bottom + (beschikbareRuimte * 0.50);
        const centerX = window.innerWidth / 2;
        
        const left = Math.max(0, centerX - nieuweWidth / 2);
        const top = centerY - nieuweHeight / 2;
        
        graffitiY = centerY;
        graffitiHoogte = nieuweHeight * 1.5;
        
        graffitiContainer.style.left = left + 'px';
        graffitiContainer.style.top = top + 'px';
        graffitiContainer.classList.add('actief');
        
        console.log('üìç Left:', Math.round(left), '| Top:', Math.round(top));
        
        // Animeer met stroke-dasharray
        let totalLength = paths.reduce((sum, p) => sum + p.length, 0);
        const schrijfDuur = 2000;
        let cumulativeLength = 0;
        let vorigePoint = null;
        
        paths.forEach(({ path, length }, idx) => {
            const startDelay = (cumulativeLength / totalLength) * schrijfDuur;
            const pathDuur = (length / totalLength) * schrijfDuur;
            cumulativeLength += length;
            
            setTimeout(() => {
                console.log(`‚úèÔ∏è [${idx}] Zet stroke properties + start onzichtbaar`);
                
                // ZET stroke properties
                path.setAttribute('stroke', kleur);
                path.setAttribute('stroke-width', '6');
                path.setAttribute('stroke-linecap', 'round');
                path.setAttribute('stroke-linejoin', 'round');
                path.setAttribute('fill', 'none');
                
                // FORCE geen andere styles
                path.style.fill = 'none';
                path.style.stroke = kleur;
                path.style.strokeWidth = '6px';
                path.style.strokeLinecap = 'round';
                path.style.strokeLinejoin = 'round';
                
                // DASHARRAY animatie
                path.style.strokeDasharray = `${length}`;
                path.style.strokeDashoffset = `${length}`;
                
                console.log(`   Dasharray: ${length}, Offset start: ${length}`);
                
                const start = performance.now();
                
                function animate(now) {
                    const elapsed = now - start;
                    const t = Math.min(elapsed / pathDuur, 1);
                    
                    const offset = length * (1 - t);
                    path.style.strokeDashoffset = `${offset}`;
                    
                    if (t === 0.5) {
                        console.log(`   50% - Offset nu: ${Math.round(offset)}`);
                    }
                    
                    // Spray
                    if (Math.random() < 0.5 && t < 0.95) {
                        try {
                            const point = path.getPointAtLength(length * t);
                            const svgRect = svg.getBoundingClientRect();
                            
                            const absoluteX = svgRect.left + point.x;
                            const absoluteY = svgRect.top + point.y;
                            
                            let angle = 0;
                            if (vorigePoint) {
                                const dx = point.x - vorigePoint.x;
                                const dy = point.y - vorigePoint.y;
                                angle = Math.atan2(dy, dx);
                            }
                            
                            for (let i = 0; i < 2; i++) {
                                maakSprayStreak(absoluteX, absoluteY, kleur, angle);
                            }
                            
                            vorigePoint = point;
                        } catch (e) {}
                    }
                    
                    if (t < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        console.log(`‚úÖ [${idx}] Path klaar - Offset eind: 0`);
                        if (idx === paths.length - 1) {
                            console.log('üéâ Alle paths geschreven!');
                            setTimeout(veegGraffitiWeg, 2000);
                        }
                    }
                }
                requestAnimationFrame(animate);
            }, startDelay);
        });
        
    } catch (error) {
        console.error('‚ùå FOUT:', error);
        graffitiBezig = false;
        setTimeout(startGraffitiAnimatie, 2000);
    }
}

function maakSprayStreak(x, y, kleur, richting) {
    const streak = document.createElement('div');
    streak.className = 'spray-streak';
    streak.style.left = x + 'px';
    streak.style.top = y + 'px';
    streak.style.backgroundColor = kleur;
    
    const spreadAngle = richting + (Math.random() - 0.5) * Math.PI / 3;
    const distance = 15 + Math.random() * 30;
    
    streak.style.setProperty('--tx', Math.cos(spreadAngle) * distance + 'px');
    streak.style.setProperty('--ty', Math.sin(spreadAngle) * distance + 'px');
    streak.style.transform = `rotate(${spreadAngle}rad)`;
    streak.style.animation = 'spray-streak 0.3s ease-out forwards';
    
    document.body.appendChild(streak);
    sprayParticles.push(streak);
    
    setTimeout(() => {
        streak.remove();
        sprayParticles = sprayParticles.filter(p => p !== streak);
    }, 300);
}

function veegGraffitiWeg() {
    console.log('üßΩ Start vegen');
    
    spons.style.display = 'block';
    wipeOverlay.style.display = 'block';

    const sponsSize = 96;
    let x = -sponsSize;
    const eindX = window.innerWidth + sponsSize;
    const snelheid = 8;

    function animeerSpons() {
        x += snelheid;
        
        spons.style.left = x + 'px';
        spons.style.top = (graffitiY - 48) + 'px';
        
        const overlayCenterX = x + (sponsSize / 2);
        wipeOverlay.style.left = '0';
        wipeOverlay.style.top = (graffitiY - graffitiHoogte / 2) + 'px';
        wipeOverlay.style.width = overlayCenterX + 'px';
        wipeOverlay.style.height = graffitiHoogte + 'px';
        
        if (x < eindX) {
            requestAnimationFrame(animeerSpons);
        } else {
            console.log('‚úÖ Vegen klaar');
            
            spons.style.display = 'none';
            wipeOverlay.style.display = 'none';
            graffitiContainer.classList.remove('actief');
            graffitiContainer.innerHTML = '';
            
            sprayParticles.forEach(p => p.remove());
            sprayParticles = [];
            
            graffitiBezig = false;
            setTimeout(startGraffitiAnimatie, 2000);
        }
    }
    animeerSpons();
}

wachtEnSpringSoms();
startGraffitiLoop();
</script>

</body>
</html>
