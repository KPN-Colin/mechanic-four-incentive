<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mechanic 4 - Q&A</title>
<link rel="icon" type="image/png" href="images/logo/m4-icon.png">
<link rel="apple-touch-icon" href="images/logo/m4-icon.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00c300">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="mobile-web-app-capable" content="yes">

<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }

html, body { height: 100%; overflow: hidden; }

body {
    background-color: #fbfdfa;
    display: flex;
    flex-direction: column;
}

header {
    background-color: #00c300;
    color: #fff;
    height: 70px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    padding: 0 20px;
    position: relative;
    z-index: 10;
}

.back-button {
    background-color: #fff;
    color: #00c300;
    border: none;
    border-radius: 25px;
    padding: 7px 12px;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.95rem;
    flex-shrink: 0;
}

.header-center {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
}

.kpn-logo { height: 38px; }

.header-title {
    font-size: 1.3rem;
    font-weight: bold;
    color: #fff;
}

.countdown {
    font-size: 0.65rem;
    color: #fff;
    position: absolute;
    right: 15px;
    text-align: center;
    line-height: 1.3;
    font-weight: bold;
}

/* VRAGEN SECTIE - scrollbaar */
.questions-section {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    padding: 15px 20px;
}

.question-item {
    background-color: #fff;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
}

.question-text {
    font-weight: bold;
    color: #333;
    margin-bottom: 8px;
    font-size: 0.9rem;
    line-height: 1.4;
}

.answer-text {
    color: #00a000;
    font-size: 0.88rem;
    line-height: 1.5;
    padding-left: 10px;
    border-left: 3px solid #00c300;
    margin-top: 8px;
}

.no-questions {
    text-align: center;
    color: #999;
    padding: 30px 20px;
    font-style: italic;
    font-size: 0.9rem;
}

.loading-text {
    text-align: center;
    color: #aaa;
    padding: 20px;
    font-style: italic;
    font-size: 0.85rem;
}

/* BEVESTIGING POPUP */
.confirmation-banner {
    display: none;
    position: fixed;
    bottom: 65px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #00c300;
    color: #fff;
    padding: 12px 20px;
    border-radius: 12px;
    font-size: 0.85rem;
    text-align: center;
    line-height: 1.4;
    z-index: 100;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    max-width: 80vw;
    animation: fadeInUp 0.3s ease;
}

@keyframes fadeInUp {
    from { opacity: 0; transform: translateX(-50%) translateY(10px); }
    to   { opacity: 1; transform: translateX(-50%) translateY(0); }
}

/* INPUT + GIF SECTIE */
.bottom-section {
    flex-shrink: 0;
    display: flex;
    align-items: flex-end;
    padding: 0 0 0 15px;
}

/* INPUT GEBIED LINKS */
.input-area {
    flex: 1;
    padding-right: 12px;
    padding-bottom: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.email-input {
    width: 100%;
    padding: 9px 15px;
    border: 2px solid #ddd;
    border-radius: 10px;
    font-size: 0.85rem;
    font-family: Arial, sans-serif;
    margin-bottom: 8px;
    transition: border-color 0.2s;
    background-color: #fff;
}

.email-input:focus {
    outline: none;
    border-color: #00c300;
}

.email-input::placeholder {
    color: #aaa;
    font-style: italic;
    font-size: 0.8rem;
}

.question-input {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #ddd;
    border-radius: 10px;
    font-size: 0.88rem;
    font-family: Arial, sans-serif;
    resize: none;
    height: 65px;
    transition: border-color 0.2s;
    background-color: #fff;
}

.question-input:focus {
    outline: none;
    border-color: #00c300;
}

.question-input::placeholder {
    color: #aaa;
    font-style: italic;
}

/* Verstuur knop gecentreerd */
.send-button {
    margin-top: 8px;
    padding: 9px 28px;
    font-size: 0.9rem;
    background-color: #00c300;
    color: #fff;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 3px 10px rgba(0, 195, 0, 0.25);
    transition: transform 0.15s ease, box-shadow 0.15s ease;
    animation: softPulse 3s ease-in-out infinite;
}

@keyframes softPulse {
    0%, 100% {
        transform: scale(1);
        box-shadow: 0 3px 10px rgba(0, 195, 0, 0.25);
    }
    50% {
        transform: scale(1.03);
        box-shadow: 0 5px 15px rgba(0, 195, 0, 0.38);
    }
}

.send-button:active {
    transform: scale(0.95) !important;
    background-color: #00a000;
    animation: none;
}

.send-button:disabled {
    animation: none;
    opacity: 0.7;
}

/* ARIE GIF — tegen footer */
.arie-section {
    width: 40vw;
    flex-shrink: 0;
    line-height: 0;
    align-self: flex-end;
}

.arie-section img {
    width: 100%;
    display: block;
}

footer {
    background-color: #00c300;
    color: #fff;
    text-align: center;
    height: 55px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    flex-shrink: 0;
}
</style>
</head>

<body>

<header>
    <button class="back-button" onclick="window.location.href='index.html'">&larr;</button>
    <div class="header-center">
        <img src="images/logo/kpn-logo.png" class="kpn-logo">
        <span class="header-title">Q&A</span>
    </div>
    <div class="countdown" id="countdown">Laden...</div>
</header>

<div class="questions-section" id="questionsSection">
    <div class="loading-text">Vragen laden...</div>
</div>

<!-- Bevestiging popup -->
<div class="confirmation-banner" id="confirmationBanner">
    ✅ Je vraag is verstuurd.<br>Je krijgt bericht zodra deze is beantwoord.
</div>

<div class="bottom-section">
    <div class="input-area">
        <input
            type="email"
            class="email-input"
            id="emailInput"
            placeholder="Jouw e-mailadres (voor berichtgeving)"
        >
        <textarea
            class="question-input"
            id="questionInput"
            placeholder=""
            maxlength="300"
        ></textarea>
        <button class="send-button" id="sendButton" onclick="submitQuestion()">Verstuur</button>
    </div>

    <div class="arie-section">
        <img src="images/mechanics/m4-arie.gif" alt="Arie">
    </div>
</div>

<footer>&copy; KPN 2026</footer>

<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').catch(function(err) {
        console.log('SW fout:', err);
    });
}

// ── AIRTABLE CONFIGURATIE ──────────────────────────────────
const AIRTABLE_API_KEY  = 'JOUW_AIRTABLE_API_KEY';
const AIRTABLE_BASE_ID  = 'JOUW_BASE_ID';
const AIRTABLE_TABLE    = 'Vragen';
// ──────────────────────────────────────────────────────────

const AIRTABLE_URL = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE}`;
const HEADERS = {
    'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
    'Content-Type': 'application/json'
};

// TYPEWRITER PLACEHOLDER
const placeholderText = "Vul hier je vraag voor de Mechanic 4 in.";
const inputEl = document.getElementById("questionInput");
let placeholderIndex = 0;

function typePlaceholder() {
    if (placeholderIndex < placeholderText.length) {
        inputEl.placeholder += placeholderText.charAt(placeholderIndex);
        placeholderIndex++;
        setTimeout(typePlaceholder, 40);
    }
}
setTimeout(typePlaceholder, 600);

// VRAGEN LADEN — alleen goedgekeurde vragen
async function loadQuestions() {
    const section = document.getElementById('questionsSection');
    try {
        const params = new URLSearchParams({
            filterByFormula: '{goedgekeurd} = TRUE()',
            'sort[0][field]': 'datum',
            'sort[0][direction]': 'desc'
        });

        const response = await fetch(`${AIRTABLE_URL}?${params}`, { headers: HEADERS });
        const data = await response.json();

        if (!data.records || data.records.length === 0) {
            section.innerHTML = '<div class="no-questions">Nog geen vragen. Stel de eerste vraag!</div>';
            return;
        }

        section.innerHTML = '';
        data.records.forEach(record => {
            const fields = record.fields;
            const item = document.createElement('div');
            item.className = 'question-item';

            const qDiv = document.createElement('div');
            qDiv.className = 'question-text';
            qDiv.textContent = '❓ ' + fields.vraag;
            item.appendChild(qDiv);

            if (fields.antwoord) {
                const aDiv = document.createElement('div');
                aDiv.className = 'answer-text';
                aDiv.textContent = fields.antwoord;
                item.appendChild(aDiv);
            }

            section.appendChild(item);
        });

    } catch (err) {
        section.innerHTML = '<div class="no-questions">Kon vragen niet laden. Probeer later opnieuw.</div>';
    }
}

// VRAAG VERSTUREN
async function submitQuestion() {
    const questionInput = document.getElementById('questionInput');
    const emailInput    = document.getElementById('emailInput');
    const btn           = document.getElementById('sendButton');
    const question      = questionInput.value.trim();
    const email         = emailInput.value.trim();

    if (!question) return;

    btn.disabled = true;
    btn.textContent = 'Versturen...';

    try {
        await fetch(AIRTABLE_URL, {
            method: 'POST',
            headers: HEADERS,
            body: JSON.stringify({
                records: [{
                    fields: {
                        vraag:         question,
                        email:         email || '',
                        antwoord:      '',
                        goedgekeurd:   false,
                        afgekeurd:     false,
                        prive_antwoord:'',
                        datum:         new Date().toISOString()
                    }
                }]
            })
        });

        questionInput.value = '';
        emailInput.value    = '';

        // Toon bevestigingsbanner
        const banner = document.getElementById('confirmationBanner');
        banner.style.display = 'block';
        setTimeout(() => { banner.style.display = 'none'; }, 5000);

        btn.textContent = 'Verstuurd ✓';
        setTimeout(() => {
            btn.textContent = 'Verstuur';
            btn.disabled    = false;
        }, 2500);

    } catch (err) {
        btn.textContent = 'Fout, probeer opnieuw';
        btn.disabled    = false;
    }
}

// Enter om te versturen
document.getElementById('questionInput').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        submitQuestion();
    }
});

// COUNTDOWN
let incentiveEnd = new Date("2026-06-01T23:59:59");
function updateCountdown() {
    let diff = incentiveEnd - new Date();
    let el   = document.getElementById("countdown");
    if (diff <= 0) { el.innerHTML = "Incentive<br>afgelopen"; return; }
    let days = Math.floor(diff / 86400000);
    if (days > 1) { el.innerHTML = `Nog<br>${days}<br>dagen`; return; }
    let hours = Math.floor(diff / 3600000);
    if (hours >= 1) { el.innerHTML = `Nog<br>${hours}<br>uur`; return; }
    el.innerHTML = `Nog<br>${Math.floor(diff / 60000)}<br>min`;
}
setInterval(updateCountdown, 60000);
updateCountdown();

loadQuestions();
</script>

</body>
</html>
